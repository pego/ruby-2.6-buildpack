#!/bin/sh

BUILD_DIR=$1
CACHE_DIR=$2

echo "Installing Ruby version 2.7.8"

# Crea una directory temporanea
mkdir -p $BUILD_DIR/.ruby

# Scarica Ruby
curl -o ruby.tar.gz https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.8.tar.gz

# Estrai e compila Ruby
tar -xzvf ruby.tar.gz -C $BUILD_DIR/.ruby
cd $BUILD_DIR/.ruby/ruby-2.7.8
./configure --prefix=$BUILD_DIR/.ruby
make && make install

if [ ! -f "$BUILD_DIR/.ruby/bin/ruby" ]; then
  echo "Errore: Ruby non Ã¨ stato installato correttamente!"
  exit 1
fi

# Aggiungi Ruby al PATH
mkdir -p $BUILD_DIR/.profile.d
echo "export PATH=$BUILD_DIR/.ruby/bin:\$PATH" >> $BUILD_DIR/.profile.d/ruby.sh

# Installa le gemme
cd $BUILD_DIR
$BUILD_DIR/.ruby/bin/bundle install --deployment --without development test
